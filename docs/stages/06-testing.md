# Этап 6: Тестирование

## Цель этапа
Покрыть код тестами для обеспечения качества и надёжности приложения.

## 6.1 Unit тесты
- [ ] Тесты для сервисов аутентификации
- [ ] Тесты для репозиториев
- [ ] Тесты для моделей валидации

### Детали реализации
- Использовать `testify` для assertions
- Мокать внешние зависимости
- Покрытие минимум 70% кода
- Тесты должны быть быстрыми (< 100ms каждый)

### Примеры тестов
```go
// Тест сервиса аутентификации
func TestAuthService_Login(t *testing.T) {
    // Arrange
    mockRepo := &MockUserRepository{}
    authService := NewAuthService(mockRepo)
    
    // Act & Assert
    // ...
}
```

## 6.2 Integration тесты
- [ ] Тесты для HTTP хендлеров
- [ ] Тесты для работы с базой данных
- [ ] Настроить тестовую базу данных

### Детали реализации
- Использовать тестовую БД (например, testcontainers)
- Тестировать полные сценарии пользователей
- Проверять HTTP статус коды и JSON ответы
- Очищать данные между тестами

### Примеры тестов
```go
// Тест HTTP хендлера
func TestAuthHandler_Login(t *testing.T) {
    // Arrange
    server := setupTestServer()
    defer server.Close()
    
    // Act
    resp := makeRequest("POST", "/api/v1/auth/login", loginData)
    
    // Assert
    assert.Equal(t, http.StatusOK, resp.StatusCode)
    // ...
}
```

## 6.3 Настройка тестового окружения
- [ ] Создать тестовую конфигурацию
- [ ] Настроить testcontainers для PostgreSQL
- [ ] Добавить Makefile команды для тестов

### Команды тестирования
```bash
# Запуск всех тестов
make test

# Запуск unit тестов
make test-unit

# Запуск integration тестов
make test-integration

# Проверка покрытия кода
make test-coverage
```

## 6.4 Тестовые данные
- [ ] Создать fixtures для тестовых данных
- [ ] Добавить factory функции для создания объектов
- [ ] Использовать faker для генерации тестовых данных

## Критерии готовности
- [ ] Покрытие кода минимум 70%
- [ ] Все unit тесты проходят
- [ ] Все integration тесты проходят
- [ ] Тесты запускаются в headless режиме
- [ ] CI/CD пайплайн проходит тесты

## Время выполнения
Ориентировочно: 2-3 дня

## Предыдущий этап
[Этап 5: API v1](./05-api-v1.md)

## Следующий этап
[Этап 7: Документация и развертывание](./07-deployment.md)
